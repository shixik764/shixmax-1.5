<!doctype html><html lang="ru"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Shixmax â€” Chat</title><link rel="stylesheet" href="styles.css"></head><body>
<div class="header"><div class="brand">Shixmax</div><div id="roomTitle" class="small">â€”</div></div>
<div class="container"><aside class="sidebar"><div class="profile-box"><div class="avatar"><img id="myAvatarImg" src="" style="width:100%;height:100%;object-fit:cover"></div><div><div id="myName" style="font-weight:700">Ğ“Ğ¾ÑÑ‚ÑŒ</div><div class="small" id="myEmail"></div></div></div><div style="margin-top:8px"><button id="backBtn" class="btn">â† ĞĞ°Ğ·Ğ°Ğ´</button></div><ul id="roomsList" class="rooms"></ul></aside><main class="main"><section id="messages" class="messages"></section><div class="footer"><label class="filebtn"><input id="fileInput" type="file" hidden>ğŸ“</label><button id="voiceBtn" class="filebtn">ğŸ¤</button><textarea id="messageInput" class="input" placeholder="Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ..." rows="1"></textarea><button id="emojiBtn" class="filebtn">ğŸ˜Š</button><div id="emojiPicker" class="emoji-picker" hidden></div><button id="sendBtn" class="btn">ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ</button></div></main></div>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script src="https://ucarecdn.com/libs/widget/3.x/uploadcare.full.min.js"></script>
<script src="firebase.js"></script>
<script src="app.js"></script>
<script>
function qsParam(n){ return new URL(location.href).searchParams.get(n); }
const room = qsParam('room') || 'general'; document.getElementById('roomTitle').textContent = room;
auth.onAuthStateChanged(async user=>{ if(!user) return location.href='index.html'; const prof=(await db.ref('profiles/'+user.uid).once('value')).val()||{}; document.getElementById('myName').textContent = prof.name||user.email; if(prof.avatar) document.getElementById('myAvatarImg').src = prof.avatar; document.getElementById('myEmail').textContent = user.email||''; const msgsEl=document.getElementById('messages'); const seen=new Set(); const mRef=db.ref('rooms/'+room+'/messages'); mRef.on('child_added', snap=>{ if(!snap.exists()) return; if(seen.has(snap.key)) return; const d=snap.val(); const div=document.createElement('div'); div.className='msg'+(d.userId===user.uid?' me':''); div.dataset.id=snap.key; div.innerHTML=`<div class="meta"><strong>${d.name}</strong> <span class="small">${new Date(d.time).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})}</span></div><div>${d.text||''}</div>`; if(d.fileUrl) div.innerHTML+=`<div style="margin-top:6px"><a href="${d.fileUrl}" target="_blank">ğŸ“ ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ»</a></div>`; msgsEl.appendChild(div); msgsEl.scrollTop=msgsEl.scrollHeight; seen.add(snap.key); }); document.getElementById('fileInput').addEventListener('change', async ()=>{ const f=document.getElementById('fileInput').files[0]; if(!f) return; const url = await (async ()=>{ const form=new FormData(); form.append('pub_key','0c7ba840bf1b89f09ee3'); form.append('file', f); const res=await fetch('https://upload.uploadcare.com/base/',{method:'POST',body:form}); const data=await res.json(); return data.file? 'https://ucarecdn.com/'+data.file : null; })(); const payload={ name: prof.name||user.email, userId: user.uid, time: Date.now(), fileUrl: url, fileType: f.type }; await db.ref('rooms/'+room+'/messages').push(payload); document.getElementById('fileInput').value=''; }); document.getElementById('sendBtn').addEventListener('click', async ()=>{ const t=document.getElementById('messageInput').value.trim(); if(!t) return; await db.ref('rooms/'+room+'/messages').push({ name: prof.name||user.email, userId: user.uid, text: t, time: Date.now() }); document.getElementById('messageInput').value=''; }); document.getElementById('messageInput').addEventListener('keydown', e=>{ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); document.getElementById('sendBtn').click(); } }); document.getElementById('emojiBtn').addEventListener('click', ()=>{ const picker=document.getElementById('emojiPicker'); if(!picker.hidden){ picker.hidden=true; return; } picker.innerHTML=''; const EM=['ğŸ‘','â¤ï¸','ğŸ˜‚','ğŸ”¥','ğŸ˜®','ğŸ˜­','ğŸ‘','ğŸ‰','ğŸ™‚','ğŸ˜…']; EM.forEach(em=>{ const b=document.createElement('button'); b.textContent=em; b.addEventListener('click', ()=>{ document.getElementById('messageInput').value += em; picker.hidden=true; document.getElementById('messageInput').focus(); }); picker.appendChild(b); }); picker.hidden=false; }); document.getElementById('backBtn').addEventListener('click', ()=> location.href='index_main.html');
</script>
</body></html>
